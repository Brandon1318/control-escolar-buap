<div class="wrapper">
  <div class="reg-shell">

    <!-- Tarjeta de Selección (Siempre visible ahora) -->
    <mat-card class="role-card">
      <mat-card-header class="role-card-header">
        <div class="actions-header-colum">
          <ng-container *ngIf="!editar; else activo">
            <mat-card-title class="title-card">Registro de usuario</mat-card-title>
            <mat-card-subtitle class="subtitle-card">
              Selecciona el tipo para mostrar el formulario correspondiente
            </mat-card-subtitle>
          </ng-container>
          <ng-template #activo>
            <mat-card-title class="title-card">Editar usuario</mat-card-title>
            <mat-card-subtitle class="subtitle-card">
              Modifica los datos del usuario seleccionado
            </mat-card-subtitle>
          </ng-template>
        </div>
        <!-- Botón de regresar siempre visible en la tarjeta -->
        <div class="actions-row">
          <button mat-icon-button class="back-btn" (click)="goBack()">
            <mat-icon class="back-icon">arrow_back</mat-icon>
          </button>
        </div>
      </mat-card-header>

      <mat-card-content>
        <div class="role-row">
          <!-- Radio Group -->
          <mat-radio-group aria-label="Tipo de usuario"
            [(ngModel)]="user.tipo_usuario"
            (change)="radioChange($event)"
            [disabled]="editar">

            <!-- ADMINISTRADOR -->
            <!-- Se muestra si tienes permiso Y (no hay rol URL o el rol es 'administrador') -->
            <mat-radio-button class="role-pill" value="administrador"
              *ngIf="(!facadeService.getUserGroup() || facadeService.getUserGroup() === 'administrador') && (!rol || rol === 'administrador')">
              <mat-icon class="me-1">admin_panel_settings</mat-icon>
              <span class="text-radio">Administrador</span>
            </mat-radio-button>

            <!-- ALUMNO -->
            <mat-radio-button class="role-pill" value="alumnos"
               *ngIf="!rol || rol === 'alumnos'">
              <mat-icon class="me-1">school</mat-icon>
              <span class="text-radio">Alumno</span>
            </mat-radio-button>

            <!-- MAESTRO -->
            <mat-radio-button class="role-pill" value="maestros"
              *ngIf="(!facadeService.getUserGroup() || facadeService.getUserGroup() === 'administrador' || facadeService.getUserGroup() === 'maestro') && (!rol || rol === 'maestros')">
              <mat-icon class="me-1">person</mat-icon>
              <span class="text-radio">Maestro</span>
            </mat-radio-button>

          </mat-radio-group>
        </div>
      </mat-card-content>
    </mat-card>

    <!-- Área de Formularios -->
    <div class="forms-area">
      <app-registro-admin *ngIf="isAdmin" [rol]="tipo_user" [datos_user]="user"></app-registro-admin>
      <app-registro-alumnos *ngIf="isAlumno" [rol]="tipo_user" [datos_user]="editar ? user : null"></app-registro-alumnos>
      <app-registro-maestros *ngIf="isMaestro" [rol]="tipo_user" [datos_user]="editar ? user : null"></app-registro-maestros>
    </div>

  </div>
</div>
